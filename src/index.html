<!DOCTYPE html>
<html>
    <head>
        <title>Block Explorer</title>
    </head>
    <body>
        <h1>Block Explorer</h1>
        Latest block: <div id="blockNumber"></div>
        <div id="chat"/>
        <script type="text/javascript">
        var uri = 'ws://' + location.host + '/blocks';
        var ws = new WebSocket(uri);
        updateBlock();

        function message(data) {
            var line = document.createElement('p');
            line.innerText = data;
            chat.appendChild(line);
        }

        async function updateBlock() {
            blockNumber.innerText = await ((await fetch('/block_number')).text())
        }

        ws.onopen = function() {
            chat.innerHTML = "<p><em>Connected!</em></p>";
        }

        ws.onmessage = async function(msg) {
            updateBlock();
            message(btoa(String.fromCharCode.apply(null, new Uint8Array(await msg.data.arrayBuffer()))));
        };
        </script>
    </body>
</html>
